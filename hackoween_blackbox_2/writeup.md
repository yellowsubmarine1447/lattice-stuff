Essentially, we are given a website which performs some sort of encryption for us. It asks us for a name, encrypts it using some method we don't know (hence the name "Black Box" in the challenge), and outputs the result of the decryption as a cookie. We can use the cookie to enter the website again, which will decrypt it for us and tell us back our name.

If you play around with the site enough, you can tell that, by modifying individual characters one at a time, around every 32 hex digits, a new 32-hex digit block of encrypted will change, while the rest will remain the same. This indicates that each 16 byte block in our name will be encrypted separately and joined together. This immediately screams ECB, and made me suspect the challenge was encrypting our name with AES ECB.

There was a previous challenge to this one, which involved encrypting our name with some weird XOR stream cipher. It did this my first putting our name in some JSON and then performing the XOR encryption. This setup appeared to be the exact same here, especially since the next 16-block block in our encrypted cookie would only change after adding 6 "A"'s, which was the exact amount to fill 2 16 byte blocks from the previous challenge's format. So, now that we know the JSON, what can we do.

My first thought was to use bruteforce each byte of the subsequent JSON, and thus the flag, using the oracle to match 16 byte blocks for me. This is a classic AES ECB "dislodging" oracle attack where you progressively bruteforce each character. I won't go into it in detail here, there's multiple resources online that could probably do it better than me (such as [this](https://crypto.stackexchange.com/questions/42891/chosen-plaintext-attack-on-aes-in-ecb-mode)). Anyway, it turns out this doesn't work because there's a double quote in front of our name. This is an issue because when trying to use this character for our AES oracle attack, it would get escaped with a backslash.

We can defeat the first double quote by filling a buffer with a bunch of backslashes and doing a slightly more complicated dislodging attack, but we run into a problem with the second buffer. We also can't start from the back because there's also a double quote at the end of the JSON.

It seems like I wasn't the only one facing this issue. After talking to another team incredibly vaguely about our issue, we both realised we were both stuck on the same problem and went through the exact same stages as each other (LMAO). We then talked to the problem author, who apparently didn't implement a working solution and realised that, yes indeed, a chosen plaintext attack didn't work. He was about to fix the issue when a burst of inspiration came to me: the website was also able to *decrypt* your cookie, so if you provided a cookie which removed the `", "flag": "` part of the JSON, we could defeat the double quotes and leak the flag directly.

I quickly told my unintended solution to the problem author so that he wouldn't fix it and I could steal all the 500 points for myself, and watched the other team wallow in misery as they struggled to figure out how to solve the challenge and didn't end up doing it in time. :D
